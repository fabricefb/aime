{% extends 'main/base.html' %}
{% load static %}

{% block title %}AIME - Agissons Ici et Maintenant pour les Enfants{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'main/hero_section.css' %}">
<style>
    /* Override pour l'image de fond de la page d'accueil */
    .hero-section::before {
        background-image: url('{% static "main/images/hero/_V6A0166.JPG" %}') !important;
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
    }
    
    :root {
        --primary-color: #2c3e50;
        --secondary-color: #3498db;
        --success-color: #27ae60;
        --warning-color: #f39c12;
        --text-dark: #2c3e50;
        --text-light: #7f8c8d;
        --bg-light: #ecf0f1;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        color: var(--text-dark);
    }

    /* Hero Section */
    .hero-section {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.9) 0%, rgba(155, 89, 182, 0.9) 100%),
                    url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23grid)"/></svg>');
        min-height: 100vh;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
        color: white;
        z-index: 1;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                    radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
        animation: pulse-bg 10s ease-in-out infinite;
    }

    @keyframes pulse-bg {
        0%, 100% { opacity: 0.5; }
        50% { opacity: 1; }
    }

    .hero-content {
        position: relative;
        z-index: 2;
    }

    .hero-title {
        font-size: clamp(2.5rem, 5vw, 4rem);
        font-weight: 800;
        margin-bottom: 1.5rem;
        line-height: 1.2;
        text-shadow: none;
    }

    .hero-subtitle {
        font-size: clamp(1.1rem, 2.5vw, 1.4rem);
        margin-bottom: 2rem;
        opacity: 0.95;
        font-weight: 300;
        max-width: 600px;
    }

    .hero-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 2rem;
        margin: 3rem 0;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .hero-stat {
        text-align: center;
    }

    .hero-stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        display: block;
        color: #fff;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .hero-stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-top: 0.5rem;
    }

    .hero-cta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 2rem;
    }

    .btn-hero {
        padding: 1rem 2rem;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: none;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .btn-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
    }

    .btn-hero:hover::before {
        left: 100%;
    }

    .btn-primary {
        background: linear-gradient(45deg, var(--secondary-color), #ff6b6b);
        color: white;
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(231, 76, 60, 0.6);
        color: white;
    }

    .btn-secondary {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 2px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
    }

    .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
        color: white;
    }

    /* Impact Section */
    .impact-section {
        padding: 8rem 0 6rem 0; /* Augmenter le padding sup√©rieur */
        background: linear-gradient(180deg, #fff 0%, var(--bg-light) 100%);
        position: relative;
        z-index: 2;
        margin-top: -2rem; /* Ajustement pour √©viter le chevauchement */
        border-top: 1px solid rgba(255, 255, 255, 0.3); /* Bordure de s√©paration */
        box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.1); /* Ombre vers le haut */
    }

    .section-title {
        text-align: center;
        margin-bottom: 4rem;
    }

    .section-title h2 {
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 700;
        margin-bottom: 1rem;
        background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .section-title p {
        font-size: 1.2rem;
        color: var(--text-light);
        max-width: 600px;
        margin: 0 auto;
    }

    .impact-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 2rem;
        padding: 2rem;
        background: #f8fafc;
        border-radius: 1.5rem;
        box-shadow: 0 4px 24px rgba(0,0,0,0.07);
        margin-top: 3rem;
    }

    .impact-card {
        background: #fff;
        border-radius: 1rem;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        padding: 2rem 1.5rem;
        text-align: center;
        transition: transform 0.4s cubic-bezier(.25,.8,.25,1), box-shadow 0.4s;
        position: relative;
        overflow: hidden;
    }

    .impact-card:hover {
        transform: translateY(-8px) scale(1.03);
        box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    }

    .impact-icon {
        font-size: 2.5rem;
        color: #3b82f6;
        margin-bottom: 1rem;
        animation: pop 0.8s;
    }

    @keyframes pop {
        0% { transform: scale(0.7); opacity: 0; }
        80% { transform: scale(1.1); opacity: 1; }
        100% { transform: scale(1); }
    }

    .impact-number {
        font-size: 2.2rem;
        font-weight: bold;
        color: #16a34a;
        margin-bottom: 0.5rem;
        transition: color 0.5s;
    }

    .impact-label {
        font-size: 1.1rem;
        font-weight: 600;
        color: #334155;
        margin-bottom: 0.5rem;
    }

    .impact-description {
        font-size: 0.98rem;
        color: #64748b;
        margin-bottom: 0.5rem;
        line-height: 1.5;
    }

    /* Programs Section */
    .programs-section {
        padding: 6rem 0;
        background: var(--primary-color);
        color: white;
    }

    .programs-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 2rem;
        margin-top: 3rem;
    }

    .program-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2.5rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }

    .program-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.15);
    }

    .program-icon {
        font-size: 3rem;
        margin-bottom: 1.5rem;
        color: var(--warning-color);
    }

    .program-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
    }

    .program-description {
        opacity: 0.9;
        line-height: 1.7;
        margin-bottom: 1.5rem;
    }

    .program-link {
        color: var(--warning-color);
        text-decoration: none;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
    }

    .program-link:hover {
        color: white;
        transform: translateX(5px);
    }

    /* CTA Section */
    .cta-section {
        padding: 6rem 0;
        background: linear-gradient(135deg, var(--secondary-color) 0%, #ff6b6b 100%);
        color: white;
        text-align: center;
    }

    .cta-content {
        max-width: 800px;
        margin: 0 auto;
    }

    .cta-title {
        font-size: clamp(2rem, 4vw, 3rem);
        font-weight: 700;
        margin-bottom: 1.5rem;
    }

    .cta-description {
        font-size: 1.2rem;
        opacity: 0.95;
        margin-bottom: 2.5rem;
        line-height: 1.7;
    }

    .cta-buttons {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .btn-cta {
        padding: 1.2rem 2.5rem;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: 2px solid transparent;
    }

    .btn-cta-white {
    background: white;
    color: var(--secondary-color);
    }

    .btn-cta-white:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    color: var(--secondary-color);
    }

    .btn-cta-outline {
        background: transparent;
        color: white;
        border-color: white;
    }

    .btn-cta-outline:hover {
    background: white;
    color: var(--secondary-color);
    transform: translateY(-3px);
    }

    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideInLeft {
        from {
            opacity: 0;
            transform: translateX(-30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .animate-fadeInUp {
        animation: fadeInUp 0.8s ease-out;
    }

    .animate-slideInLeft {
        animation: slideInLeft 0.8s ease-out;
    }

    .animate-slideInRight {
        animation: slideInRight 0.8s ease-out;
    }

    /* Smooth transition between sections */
    section {
        position: relative;
    }

    .hero-section + .impact-section {
        margin-top: 0;
        padding-top: 8rem; /* Espace suppl√©mentaire au-dessus de la section impact */
        border-top: 2px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.1);
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
        
        .hero-cta {
            flex-direction: column;
            align-items: center;
        }
        
        .btn-hero {
            width: 100%;
            justify-content: center;
            max-width: 300px;
        }
        
        .impact-grid {
            grid-template-columns: 1fr;
        }
        
        .programs-grid {
            grid-template-columns: 1fr;
        }
        
        .cta-buttons {
            flex-direction: column;
            align-items: center;
        }
        
        .btn-cta {
            width: 100%;
            max-width: 300px;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="hero-content">
                    <h1 class="hero-title animate-fadeInUp">
                        Agissons Ici et Maintenant pour les 
                        <span style="background: linear-gradient(45deg, #1299f3, #f5f3f2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: none;">Enfants</span>
                    </h1>
                    <p class="hero-subtitle animate-slideInLeft">
                        Organisation d√©di√©e au d√©veloppement socio-√©ducationnel, entrepreneurial et √† la formation 
                        en divers m√©tiers pour l'√©panouissement des enfants en R√©publique D√©mocratique du Congo.
                    </p>
                    
                    <div class="hero-stats animate-slideInRight">
                        <div class="hero-stat">
                            <span class="hero-stat-number" data-target="{{ stats.total_children_helped }}">0</span>
                            <div class="hero-stat-label">Enfants aid√©s</div>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number" data-target="{{ stats.active_projects }}">0</span>
                            <div class="hero-stat-label">Projets actifs</div>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number" data-target="{{ stats.total_events }}">0</span>
                            <div class="hero-stat-label">√âv√©nements</div>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-number" data-target="{{ stats.total_donations }}">0</span>
                            <div class="hero-stat-label">FC collect√©s</div>
                        </div>
                    </div>
                    
                    <div class="hero-cta">
                        {% if user.is_authenticated %}
                        <a href="{% url 'main:dashboard_home' %}" class="btn-hero btn-primary">
                            <i class="fas fa-tachometer-alt"></i>
                            Mon tableau de bord
                        </a>
                        {% endif %}
                        <a href="{% url 'main:projects' %}" class="btn-hero btn-primary">
                            <i class="fas fa-rocket"></i>
                            D√©couvrir nos projets
                        </a>
                        <a href="{% url 'main:interactive_map' %}" class="btn-hero btn-secondary">
                            <i class="fas fa-map-marked-alt"></i>
                            Voir notre impact
                        </a>
                        {% if not user.is_authenticated %}
                        <a href="{% url 'main:signup' %}" class="btn-hero btn-secondary">
                            <i class="fas fa-user-plus"></i>
                            Rejoindre AIME
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <div class="position-relative">
                    <i class="fas fa-child" style="font-size: 15rem; opacity: 0.8; color: rgba(255,255,255,0.9);"></i>
                    <div class="position-absolute top-0 end-0">
                        <span class="badge bg-success rounded-pill" style="animation: pulse 2s infinite;">
                            <i class="fas fa-satellite-dish me-1"></i>En direct
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Impact Section -->
<section class="impact-section">
    <div class="container">
        <div class="section-title">
            <h2>Notre Impact Concret</h2>
            <p>D√©couvrez comment AIME transforme concr√®tement la vie des enfants et de leurs communaut√©s √† travers nos programmes innovants.</p>
        </div>
        
        <div class="impact-grid">
            <div class="impact-card">
                <div class="impact-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="impact-number" data-target="{{ stats.formations_dispensed }}">0</div>
                <div class="impact-label">Formations dispens√©es</div>
                <div class="impact-description">
                    Formations en informatique, m√©canique v√©lo, entrepreneuriat et d√©veloppement personnel pour autonomiser les jeunes.
                </div>
            </div>
            
            <div class="impact-card">
                <div class="impact-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="impact-number" data-target="{{ stats.families_supported }}">0</div>
                <div class="impact-label">Familles soutenues</div>
                <div class="impact-description">
                    Accompagnement direct des familles vuln√©rables √† travers nos programmes d'assistance et de d√©veloppement communautaire.
                </div>
            </div>
            
            <div class="impact-card">
                <div class="impact-icon">
                    <i class="fas fa-bicycle"></i>
                </div>
                <div class="impact-number" data-target="{{ stats.mbc_participants }}">0</div>
                <div class="impact-label">Participants MBC</div>
                <div class="impact-description">
                    Jeunes ayant particip√© au Mutoto Bike Challenge, notre programme phare de sensibilisation environnementale.
                </div>
            </div>
            
            <div class="impact-card">
                <div class="impact-icon">
                    <i class="fas fa-seedling"></i>
                </div>
                <div class="impact-number" data-target="{{ stats.quartiers_impacted }}">0</div>
                <div class="impact-label">Quartiers impact√©s</div>
                <div class="impact-description">
                    Communaut√©s o√π nous intervenons activement pour am√©liorer les conditions de vie et cr√©er des opportunit√©s.
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Programs Section -->
<section class="programs-section">
    <div class="container">
        <div class="section-title">
            <h2 style="color: white;">Nos Programmes Phares</h2>
            <p style="color: rgba(255,255,255,0.9);">Des initiatives concr√®tes pour l'√©panouissement et l'autonomisation des enfants et jeunes de la RDC.</p>
        </div>
        
        <div class="programs-grid">
            <div class="program-card">
                <div class="program-icon">
                    <i class="fas fa-bicycle"></i>
                </div>
                <h3 class="program-title">Mutoto Bike Challenge</h3>
                <p class="program-description">
                    Un d√©fi cycliste annuel qui sensibilise les jeunes √† la protection de l'environnement tout en promouvant le sport et la coh√©sion sociale.
                </p>
                <a href="{% url 'main:mutoto_bike_challenge' %}" class="program-link">
                    En savoir plus <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="program-card">
                <div class="program-icon">
                    <i class="fas fa-microscope"></i>
                </div>
                <h3 class="program-title">Muto Science Adventure</h3>
                <p class="program-description">
                    Programme d'initiation aux sciences et technologies pour √©veiller la curiosit√© scientifique des enfants et d√©velopper leur esprit critique.
                </p>
                <a href="{% url 'main:about' %}" class="program-link">
                    En savoir plus <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="program-card">
                <div class="program-icon">
                    <i class="fas fa-laptop-code"></i>
                </div>
                <h3 class="program-title">√âcole Num√©rique</h3>
                <p class="program-description">
                    Formation aux outils num√©riques et √† la programmation pour pr√©parer les jeunes aux m√©tiers du futur et r√©duire la fracture num√©rique.
                </p>
                <a href="{% url 'main:projects' %}" class="program-link">
                    En savoir plus <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta-section">
    <div class="container">
        <div class="cta-content">
            <h2 class="cta-title">Rejoignez Notre Mission</h2>
            <p class="cta-description">
                Ensemble, nous pouvons cr√©er un avenir meilleur pour les enfants de la RDC. 
                Votre soutien, quelle que soit sa forme, fait la diff√©rence dans la vie de centaines d'enfants.
            </p>
            <div class="cta-buttons">
                <a href="{% url 'main:donate' %}" class="btn-cta btn-cta-white">
                    <i class="fas fa-heart"></i>
                    Faire un don
                </a>
                <a href="{% url 'main:contact' %}" class="btn-cta btn-cta-outline">
                    <i class="fas fa-hands-helping"></i>
                    Devenir b√©n√©vole
                </a>
            </div>
        </div>
    </div>
</section>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation des compteurs
    function animateCounters() {
        const counters = document.querySelectorAll('[data-target]');
        const observerOptions = {
            threshold: 0.5,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.classList.contains('animated')) {
                    const counter = entry.target;
                    const target = parseInt(counter.getAttribute('data-target'));
                    const duration = 2000;
                    const increment = target / (duration / 16);
                    let current = 0;

                    counter.classList.add('animated');

                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= target) {
                            counter.textContent = target.toLocaleString();
                            clearInterval(timer);
                        } else {
                            counter.textContent = Math.floor(current).toLocaleString();
                        }
                    }, 16);
                }
            });
        }, observerOptions);

        counters.forEach(counter => observer.observe(counter));
    }

    // Animation des √©l√©ments au scroll
    function initScrollAnimations() {
        const elements = document.querySelectorAll('.impact-card, .program-card');
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }, index * 100);
                }
            });
        }, observerOptions);

        elements.forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = 'all 0.8s ease-out';
            observer.observe(el);
        });
    }

    // Parallax effect for hero section
    function initParallax() {
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const heroSection = document.querySelector('.hero-section');
            if (heroSection && scrolled < heroSection.offsetHeight) {
                // R√©duire l'effet parallax pour √©viter les chevauchements
                const parallaxOffset = Math.min(scrolled * 0.15, heroSection.offsetHeight * 0.3);
                heroSection.style.transform = `translateY(${parallaxOffset}px)`;
            }
        });
    }

    // Initialize all animations
    animateCounters();
    initScrollAnimations();
    initParallax();

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Initialize Live Chat
    initLiveChat();
});

// Fonction pour r√©cup√©rer le token CSRF
function getCSRFToken() {
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
    return csrfToken ? csrfToken.value : '';
}

// Live Chat Functionality
function initLiveChat() {
    const chatWidget = document.getElementById('livechat-widget');
    const chatToggle = document.getElementById('chat-toggle');
    const chatClose = document.getElementById('chat-close');
    const chatSend = document.getElementById('chat-send');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');
    
    let isOpen = false;
    
    // Toggle chat
    chatToggle.addEventListener('click', () => {
        isOpen = !isOpen;
        chatWidget.classList.toggle('open', isOpen);
        if (isOpen) {
            chatInput.focus();
            // Welcome message
            if (chatMessages.children.length === 0) {
                addMessage('üëã Bonjour ! Je suis l\'assistant AIME. Comment puis-je vous aider aujourd\'hui ? Si vous pr√©f√©rez parler directement avec un humain, cliquez sur le bouton vert √† c√¥t√© !', 'bot');
            }
        }
    });
    
    // Close chat
    chatClose.addEventListener('click', () => {
        isOpen = false;
        chatWidget.classList.remove('open');
    });
    
    // Send message
    function sendMessage() {
        const message = chatInput.value.trim();
        if (message) {
            addMessage(message, 'user');
            chatInput.value = '';
            
            // Simulate typing
            setTimeout(() => {
                const response = getBotResponse(message);
                addMessage(response, 'bot');
                
                // Sometimes offer human assistance
                if (shouldOfferHumanHelp(message)) {
                    setTimeout(() => {
                        addHumanAssistanceButton();
                    }, 2000);
                }
            }, 1000);
        }
    }
    
    chatSend.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });
    
    // Quick human help button
    const humanHelpQuick = document.getElementById('human-help-quick');
    humanHelpQuick.addEventListener('click', () => {
        const userMessage = Array.from(chatMessages.querySelectorAll('.chat-message.user .message-content'))
            .map(el => el.textContent)
            .join(' | ');
        
        const whatsappUrl = `https://wa.me/243823090002?text=${encodeURIComponent(
            `Bonjour AIME ! J'aimerais parler directement avec un membre de votre √©quipe. Voici mon historique avec l'assistant : ${userMessage || 'Nouvelle conversation'}`
        )}`;
        
        window.open(whatsappUrl, '_blank');
        
        // Add confirmation message
        addMessage('‚úÖ Vous allez √™tre redirig√© vers WhatsApp pour parler avec un membre de notre √©quipe !', 'bot');
    });
    
    // Add message to chat
    function addMessage(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender}`;
        messageDiv.innerHTML = `
            <div class="message-content">${text}</div>
            <div class="message-time">${new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</div>
        `;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // Simple bot responses
    function getBotResponse(message) {
        const lowerMessage = message.toLowerCase();
        
        if (lowerMessage.includes('don') || lowerMessage.includes('donner')) {
            return 'üíù Merci pour votre int√©r√™t ! Vous pouvez faire un don <a href="/donate/" target="_blank">ici</a>. Chaque contribution compte pour aider nos enfants.';
        }
        
        if (lowerMessage.includes('projet') || lowerMessage.includes('programme')) {
            return 'üöÄ D√©couvrez nos projets <a href="/projects/" target="_blank">ici</a>. Nous avons le Mutoto Bike Challenge, l\'√âcole Num√©rique et bien plus !';
        }
        
        if (lowerMessage.includes('b√©n√©vole') || lowerMessage.includes('volontaire')) {
            return 'ü§ù Formidable ! Contactez-nous <a href="/contact/" target="_blank">ici</a> pour rejoindre notre √©quipe de b√©n√©voles.';
        }
        
        if (lowerMessage.includes('contact') || lowerMessage.includes('t√©l√©phone') || lowerMessage.includes('email')) {
            return 'üìß Vous pouvez nous contacter via notre <a href="/contact/" target="_blank">formulaire de contact</a> ou par email : contact@aime-rdc.org';
        }
        
        if (lowerMessage.includes('mbc') || lowerMessage.includes('v√©lo') || lowerMessage.includes('bike')) {
            return 'üö¥‚Äç‚ôÇÔ∏è Le Mutoto Bike Challenge est notre programme phare ! D√©couvrez-le <a href="/mbc/" target="_blank">ici</a>.';
        }
        
        if (lowerMessage.includes('bonjour') || lowerMessage.includes('salut') || lowerMessage.includes('hello')) {
            return 'üëã Bonjour ! Je suis ravi de vous parler. Comment puis-je vous aider avec AIME aujourd\'hui ?';
        }
        
        if (lowerMessage.includes('merci')) {
            return 'üòä Je vous en prie ! N\'h√©sitez pas si vous avez d\'autres questions.';
        }
        
        // Default responses
        const defaultResponses = [
            'ü§î Je peux vous aider avec nos projets, donations, b√©n√©volat ou informations de contact. Que souhaitez-vous savoir ?',
            'üí° Pour plus d\'informations d√©taill√©es, visitez notre page <a href="/about/" target="_blank">√Ä propos</a> ou <a href="/contact/" target="_blank">contactez-nous</a> directement.',
            'üìû Si vous pr√©f√©rez parler √† un humain, contactez-nous <a href="/contact/" target="_blank">ici</a> !',
        ];
        
        return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
    }
    
    // Check if we should offer human assistance
    function shouldOfferHumanHelp(message) {
        const lowerMessage = message.toLowerCase();
        const humanKeywords = ['urgent', 'aide', 'probl√®me', 'question', 'parler', 'humain', 'personne', 'directement', 'imm√©diatement'];
        
        // Offer human help for urgent matters or specific requests
        return humanKeywords.some(keyword => lowerMessage.includes(keyword)) || Math.random() < 0.3; // 30% chance for general questions
    }
    
    // Add human assistance button
    function addHumanAssistanceButton() {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'chat-message bot';
        messageDiv.innerHTML = `
            <div class="message-content">
                <p>ü§ù Pour une assistance plus personnalis√©e, je peux vous connecter avec un membre de notre √©quipe :</p>
                <button id="human-help-btn" class="human-help-btn">
                    <i class="fab fa-whatsapp"></i> Contacter via WhatsApp
                </button>
                <p style="margin-top: 8px; font-size: 0.8em; opacity: 0.8;">
                    Ou appelez-nous directement : +243 823 090 002
                </p>
            </div>
            <div class="message-time">${new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})}</div>
        `;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Add event listener to the button
        document.getElementById('human-help-btn').addEventListener('click', () => {
            // R√©cup√©rer l'historique de la conversation
            const conversationHistory = Array.from(chatMessages.querySelectorAll('.chat-message'))
                .map(msg => {
                    const sender = msg.classList.contains('user') ? 'Visiteur' : 'Assistant';
                    const content = msg.querySelector('.message-content').textContent;
                    return `${sender}: ${content}`;
                })
                .join('\n');
            
            // Envoyer notification au backend
            fetch('/api/chat/notification/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify({
                    message: 'Demande d\'assistance humaine via le chat',
                    history: conversationHistory,
                    email: 'visiteur@site.com', // Peut √™tre r√©cup√©r√© depuis un formulaire
                    name: 'Visiteur du site'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('Notification envoy√©e avec succ√®s');
                } else {
                    console.error('Erreur lors de l\'envoi de la notification:', data.error);
                }
            })
            .catch(error => {
                console.error('Erreur r√©seau:', error);
            });
            
            const whatsappUrl = `https://wa.me/243823090002?text=${encodeURIComponent(
                `Bonjour AIME ! J'aimerais parler directement avec un membre de votre √©quipe. Voici mon historique avec l'assistant : ${conversationHistory}`
            )}`;
            
            window.open(whatsappUrl, '_blank');
            
            // Add confirmation message
            setTimeout(() => {
                addMessage('‚úÖ Vous allez √™tre redirig√© vers WhatsApp pour parler avec un membre de notre √©quipe !', 'bot');
            }, 1000);
        });
    }
}
</script>
{% endblock %}

<!-- Live Chat Widget -->
<div id="livechat-widget" class="livechat-widget">
    <div class="chat-header">
        <div class="chat-avatar">
            <img src="{% static 'main/images/logo-aime.png' %}" alt="AIME Logo" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
        </div>
        <div class="chat-info">
            <div class="chat-title">Assistant AIME</div>
            <div class="chat-status">
                <i class="fas fa-circle" style="color: #25d366; margin-right: 5px;"></i>
                En ligne avec support humain
            </div>
        </div>
        <button id="chat-close" class="chat-close">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div id="chat-messages" class="chat-messages">
        <!-- Messages will be added here dynamically -->
    </div>
    
    <div class="chat-input-area">
        <input type="text" id="chat-input" placeholder="Tapez votre message..." autocomplete="off">
        <button id="human-help-quick" class="human-help-quick" title="Parler √† un humain">
            <i class="fas fa-user-friends"></i>
        </button>
        <button id="chat-send" class="chat-send">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>

<button id="chat-toggle" class="chat-toggle">
    <img src="{% static 'main/images/logo-aime.png' %}" alt="AIME Chat" style="width: 70%; height: 70%; border-radius: 50%; object-fit: cover;">
    <span class="chat-notification">1</span>
</button>

<style>
/* Live Chat Styles */
.chat-toggle {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: linear-gradient(45deg, #3498db, #2980b9);
    color: white;
    border: none;
    border-radius: 50%;
    box-shadow: 0 4px 20px rgba(52, 152, 219, 0.4);
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    padding: 0;
}

.chat-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 25px rgba(52, 152, 219, 0.6);
}

.chat-notification {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #e74c3c;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: bold;
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

.livechat-widget {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 350px;
    height: 500px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    z-index: 999;
    transform: translateY(100%) scale(0.8);
    opacity: 0;
    transition: all 0.3s ease;
    overflow: hidden;
    border: 1px solid #e1e8ed;
}

.livechat-widget.open {
    transform: translateY(0) scale(1);
    opacity: 1;
}

.chat-header {
    background: linear-gradient(45deg, #3498db, #2980b9);
    color: white;
    padding: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.chat-avatar {
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.chat-info {
    flex: 1;
}

.chat-title {
    font-weight: 600;
    font-size: 1rem;
    margin-bottom: 2px;
}

.chat-status {
    font-size: 0.8rem;
    opacity: 0.9;
}

.chat-close {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    transition: background 0.3s;
}

.chat-close:hover {
    background: rgba(255, 255, 255, 0.2);
}

.chat-messages {
    height: 350px;
    overflow-y: auto;
    padding: 15px;
    background: #f8f9fa;
}

.chat-message {
    margin-bottom: 15px;
    animation: fadeInUp 0.3s ease;
}

.chat-message.user {
    text-align: right;
}

.chat-message.user .message-content {
    background: #3498db;
    color: white;
    margin-left: 50px;
}

.chat-message.bot .message-content {
    background: white;
    color: #2c3e50;
    margin-right: 50px;
    border: 1px solid #e1e8ed;
}

.message-content {
    padding: 10px 15px;
    border-radius: 18px;
    display: inline-block;
    max-width: 80%;
    word-wrap: break-word;
    line-height: 1.4;
}

.message-content a {
    color: inherit;
    text-decoration: underline;
    font-weight: 600;
}

.message-time {
    font-size: 0.7rem;
    color: #7f8c8d;
    margin-top: 5px;
}

.chat-input-area {
    padding: 15px;
    background: white;
    display: flex;
    gap: 10px;
    border-top: 1px solid #e1e8ed;
}

#chat-input {
    flex: 1;
    padding: 10px 15px;
    border: 1px solid #e1e8ed;
    border-radius: 25px;
    outline: none;
    font-size: 0.9rem;
}

#chat-input:focus {
    border-color: #3498db;
}

.chat-send {
    width: 40px;
    height: 40px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.chat-send:hover {
    background: #2980b9;
    transform: scale(1.1);
}

/* Mobile responsive */
@media (max-width: 768px) {
    .livechat-widget {
        width: calc(100vw - 40px);
        height: 400px;
        right: 20px;
        left: 20px;
    }
    
    .chat-toggle {
        bottom: 15px;
        right: 15px;
    }
}

/* Scrollbar styling */
.chat-messages::-webkit-scrollbar {
    width: 6px;
}

.chat-messages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.chat-messages::-webkit-scrollbar-thumb {
    background: #bdc3c7;
    border-radius: 3px;
}

.chat-messages::-webkit-scrollbar-thumb:hover {
    background: #95a5a6;
}

/* Human assistance button */
.human-help-btn {
    background: linear-gradient(45deg, #25d366, #128c7e);
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 25px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(37, 211, 102, 0.3);
}

.human-help-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
    background: linear-gradient(45deg, #128c7e, #25d366);
}

.human-help-btn i {
    font-size: 1rem;
}

/* Quick human help button */
.human-help-quick {
    width: 40px;
    height: 40px;
    background: linear-gradient(45deg, #25d366, #128c7e);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    box-shadow: 0 2px 8px rgba(37, 211, 102, 0.3);
}

.human-help-quick:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
    background: linear-gradient(45deg, #128c7e, #25d366);
}
</style>

{% endblock %}
