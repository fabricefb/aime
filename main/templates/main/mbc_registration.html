{% extends 'main/base.html' %}
{% load static %}

{% block title %}Inscription MBC{% endblock %}

{% block extra_css %}
<style>
    .registration-form {
        background: linear-gradient(135deg, rgba(52, 152, 219, 0.05) 0%, rgba(155, 89, 182, 0.05) 100%);
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .form-control:focus {
        border-color: #3498db;
        box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
    }
    
    .btn-register {
        background: linear-gradient(45deg, #3498db, #2980b9);
        border: none;
        padding: 12px 30px;
        border-radius: 50px;
        color: white;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-register:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        color: white;
    }
    
    .event-info {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        border-left: 4px solid #3498db;
        margin-bottom: 2rem;
    }
    
    .registration-header {
        text-align: center;
        margin-bottom: 3rem;
    }
    
    .registration-header h1 {
        color: #2c3e50;
        font-weight: 700;
        margin-bottom: 1rem;
    }
    
    .registration-header p {
        color: #7f8c8d;
        font-size: 1.1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="registration-header">
                <h1><i class="fas fa-bicycle me-2 text-primary"></i>Inscription Mutoto Bike Challenge</h1>
                <p>Rejoignez-nous pour cette aventure cycliste éducative et amusante !</p>
            </div>

            {% if event %}
            <div class="event-info">
                <h4 class="text-primary mb-3">
                    <i class="fas fa-info-circle me-2"></i>Informations sur l'événement
                </h4>
                <div class="row">
                    <div class="col-md-6">
                        <p><strong><i class="fas fa-tag me-2"></i>Événement :</strong> {{ event.name }}</p>
                        <p><strong><i class="fas fa-calendar me-2"></i>Date :</strong> {{ event.date|date:"l d F Y à H:i" }}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong><i class="fas fa-map-marker-alt me-2"></i>Lieu :</strong> {{ event.location }}</p>
                        <p><strong><i class="fas fa-users me-2"></i>Places disponibles :</strong> 
                            {{ event.max_participants|add:"-"|add:event.participants_count }} / {{ event.max_participants }}
                        </p>
                    </div>
                </div>
                {% if event.description %}
                <div class="mt-3">
                    <p><strong><i class="fas fa-align-left me-2"></i>Description :</strong></p>
                    <p class="text-muted">{{ event.description|truncatewords:30 }}</p>
                </div>
                {% endif %}
                {% if event.registration_fee > 0 %}
                <div class="alert alert-info mt-3">
                    <i class="fas fa-money-bill-wave me-2"></i>
                    <strong>Frais d'inscription :</strong> {{ event.registration_fee }} FC
                </div>
                {% endif %}
            </div>

            <div class="registration-form">
                <h4 class="text-center mb-4">
                    <i class="fas fa-user-plus me-2"></i>Formulaire d'inscription
                </h4>
                
                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Erreurs dans le formulaire :</h6>
                        {{ form.errors }}
                    </div>
                    {% endif %}

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.participant_name.id_for_label }}" class="form-label">
                                <i class="fas fa-child me-2"></i>Nom du participant *
                            </label>
                            {{ form.participant_name }}
                            {% if form.participant_name.help_text %}
                            <div class="form-text">{{ form.participant_name.help_text }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.age.id_for_label }}" class="form-label">
                                <i class="fas fa-birthday-cake me-2"></i>Âge *
                            </label>
                            {{ form.age }}
                            {% if form.age.help_text %}
                            <div class="form-text">{{ form.age.help_text }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.parent_name.id_for_label }}" class="form-label">
                                <i class="fas fa-user me-2"></i>Nom du parent/tuteur
                            </label>
                            {{ form.parent_name }}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.parent_phone.id_for_label }}" class="form-label">
                                <i class="fas fa-phone me-2"></i>Téléphone parent
                            </label>
                            {{ form.parent_phone }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.participant_email.id_for_label }}" class="form-label">
                                <i class="fas fa-envelope me-2"></i>Email *
                            </label>
                            {{ form.participant_email }}
                            <div class="form-text">Nous vous enverrons la confirmation et les détails à cette adresse.</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.participant_phone.id_for_label }}" class="form-label">
                                <i class="fas fa-phone me-2"></i>Téléphone participant *
                            </label>
                            {{ form.participant_phone }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.emergency_contact.id_for_label }}" class="form-label">
                                <i class="fas fa-phone-square-alt me-2"></i>Contact d'urgence *
                            </label>
                            {{ form.emergency_contact }}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.emergency_phone.id_for_label }}" class="form-label">
                                <i class="fas fa-phone-alt me-2"></i>Téléphone d'urgence *
                            </label>
                            {{ form.emergency_phone }}
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="form-check">
                            {{ form.terms_accepted }}
                            <label class="form-check-label" for="{{ form.terms_accepted.id_for_label }}">
                                <i class="fas fa-check-circle me-2"></i>
                                J'accepte les <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">termes et conditions</a> 
                                et autorise la participation *
                            </label>
                        </div>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-register btn-lg">
                            <i class="fas fa-paper-plane me-2"></i>Inscrire mon enfant
                        </button>
                        <div class="mt-3">
                            <a href="{% url 'main:mutoto_bike_challenge' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Retour au MBC
                            </a>
                        </div>
                    </div>
                </form>
            </div>

            {% else %}
            <div class="alert alert-warning text-center">
                <h4><i class="fas fa-exclamation-triangle me-2"></i>Aucun événement disponible</h4>
                <p>Il n'y a actuellement aucun Mutoto Bike Challenge ouvert aux inscriptions.</p>
                <a href="{% url 'main:mutoto_bike_challenge' %}" class="btn btn-primary">
                    <i class="fas fa-info-circle me-2"></i>En savoir plus sur le MBC
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Modal Termes et Conditions -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-file-contract me-2"></i>Termes et Conditions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>Participation au Mutoto Bike Challenge</h6>
                <p>En inscrivant votre enfant au Mutoto Bike Challenge, vous acceptez que :</p>
                <ul>
                    <li>Votre enfant participera sous votre responsabilité</li>
                    <li>AIME fournira un encadrement sécurisé mais ne peut être tenu responsable des accidents</li>
                    <li>Les photos/vidéos de l'événement pourront être utilisées pour la communication d'AIME</li>
                    <li>Vous fournirez des informations exactes et complètes</li>
                    <li>Vous respecterez les consignes de sécurité données par l'équipe</li>
                </ul>
                
                <h6>Protection des données</h6>
                <p>Vos données personnelles sont collectées uniquement pour l'organisation de l'événement et ne seront pas partagées avec des tiers.</p>
                
                <h6>Annulation</h6>
                <p>En cas d'annulation de votre part, merci de nous prévenir au moins 48h à l'avance.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
